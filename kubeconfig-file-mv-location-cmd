On bastion:

curl -vk https://<your-cluster-endpoint>


#Now you should see certificate output instead of timeout.

Then test:

# it will work for temprarly 

export KUBECONFIG=/home/ubuntu/kubeconfig-private-eks.yaml

kubectl get nodes


# it will work permanently 

mkdir -p ~/.kube
cp /home/ubuntu/kubeconfig-private-eks.yaml ~/.kube/config

Run the command:

kubectl get nodes

or 

aws eks update-kubeconfig --name <cluster-name>  --region <region-name>

# By default in any cluster metric server not installed so we have to install as per requirement using below command

kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml

# after run the below command to add two arguements for insecuretls

kubectl -n kube-system edit deployment metrics-server


# And under spec.template.spec.containers.args, add:

- --kubelet-insecure-tls
- --kubelet-preferred-address-types=InternalIP

Check your current context

kubectl config current-context

kubectl config get-contexts

# pvt end point cluster commands for demo 

    1  apt update -y
    2  curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
    3  curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl.sha256"
    4  echo "$(cat kubectl.sha256)  kubectl" | sha256sum --check
    5  sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
    6  kubectl version --client
    7  aws --version
    8  apt install awscli -y
    9  apt install unzip -y
   10  curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
   11  unzip awscliv2.zip
   12  sudo ./aws/install
   13  aws --version
   14  kubectl get nodes
   15  vi kubeconfig-private-eks-cluster.yaml
   16  ls
   17  cat kubeconfig-private-eks-cluster.yaml
   18  aws eks update-kubeconfig --name private-eks-cluster  --region us-west-1
   19  mkdir -p ~/.kube
   20  cp /home/ubuntu/kubeconfig-private-eks.yaml ~/.kube/config
   21  ls
   22  cp /home/ubuntu/kubeconfig-private-eks-cluster.yaml ~/.kube/config
   23  kubectl get nodes
   24  aws configure
   25  kubectl get nodes
   26  kubectl get ns
   27  kubectl top nodes
   28  kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
   29  kubectl top nodes
   30  kubectl -n kube-system edit deployment metrics-server
   31  kubectl top nodes
   32  kubectl top pods
   33  kubectl top pods -A
